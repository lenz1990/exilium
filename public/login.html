<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Login – Exilium</title>
  <link rel="stylesheet" href="/styles.css" />
</head>
<body>
  <div style="min-height:100vh;display:grid;place-items:center;padding:24px;">
    <div style="width:min(520px,100%);padding:22px;border-radius:16px;background:rgba(20,22,30,.65);backdrop-filter:blur(10px);box-shadow:0 10px 30px rgba(0,0,0,.25);">
      <h1 style="margin:0 0 14px;">Login</h1>

      <form id="loginForm">
        <label style="display:block;margin:12px 0 6px;">Username</label>
        <input id="username" autocomplete="username" required
               style="width:100%;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,.15);background:rgba(255,255,255,.06);color:inherit;outline:none;" />

        <label style="display:block;margin:12px 0 6px;">Passwort</label>
        <input id="password" type="password" autocomplete="current-password" required
               style="width:100%;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,.15);background:rgba(255,255,255,.06);color:inherit;outline:none;" />

        <button id="btn" type="submit"
                style="margin-top:14px;padding:10px 14px;border-radius:10px;border:1px solid rgba(255,255,255,.18);background:rgba(120,90,255,.25);color:inherit;cursor:pointer;">
          Einloggen
        </button>
      </form>

      <div id="msg" style="margin-top:12px;padding:10px 12px;border-radius:10px;display:none;"></div>

      <div style="margin-top:14px;display:flex;gap:12px;opacity:.9;">
        <a href="/" style="color:inherit;text-decoration:none;border-bottom:1px dashed rgba(255,255,255,.35);">Start</a>
        <a href="/setup" style="color:inherit;text-decoration:none;border-bottom:1px dashed rgba(255,255,255,.35);">Setup</a>
      </div>
    </div>
  </div>

  <script>
    const form = document.getElementById("loginForm");
    const btn  = document.getElementById("btn");
    const msg  = document.getElementById("msg");

    function showErr(text){
      msg.style.display="block";
      msg.style.border="1px solid rgba(255,80,80,.35)";
      msg.style.background="rgba(255,80,80,.08)";
      msg.textContent=text;
    }
    function showOk(text){
      msg.style.display="block";
      msg.style.border="1px solid rgba(80,255,140,.35)";
      msg.style.background="rgba(80,255,140,.08)";
      msg.textContent=text;
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      msg.style.display = "none";

      const username = document.getElementById("username").value.trim();
      const password = document.getElementById("password").value;

      btn.disabled = true;
      btn.textContent = "…";

      try {
        const res = await fetch("/api/login", {
          method: "POST",
          headers: { "content-type": "application/json" },
          credentials: "include",
          body: JSON.stringify({ username, password })
        });

        const data = await res.json().catch(() => null);

        if (!res.ok || !data || data.ok !== true) {
          showErr((data && data.error) ? data.error : ("Login fehlgeschlagen (" + res.status + ")"));
          return;
        }

        showOk("Login ok – weiterleiten…");
        setTimeout(() => location.href = "/app", 200);
      } catch (err) {
        showErr("Netzwerkfehler: " + (err?.message || err));
      } finally {
        btn.disabled = false;
        btn.textContent = "Einloggen";
      }
    });
  </script>
</body>
</html>
